package servlet.basic;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class CounterServlet extends HttpServlet{
	private int counter; // 요청자의 counter 값 ( 몇번째 요청한 것인지)를 지정할 변수.
	private String path = "C:\\JAVA\\counter.dat";
	
	//client의 요청을 처리하는 메소드 - 요청방식 - GET:doGet(), POST : doPost()
	public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException{
		//응답헤더에 content-type 을 지정
		response.setContentType("text/html;charset=UTF-8"); //응답 헤더에 content-type을 지정
		//요청한 클라이언트와 연결된 출력 Stream
		PrintWriter out = response.getWriter();
		out.println("<html><head><title>카운터 서블릿</title></head><body>");
		counter++;
		out.println("당신은 "+counter+"번째 죽겠어를 외쳤습니다.<br/>");
		out.println("</body></html>");
	}
	
	
	public void init(){
		File file = new File(path);
		FileOutputStream fos = null;
		byte[] b = new byte[100];
		try {
			fos = new FileOutputStream(file);
			fos.write(b);
			while(fos!=null){
				fos.write(b);
			}
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
	public void destroy(){
		File file = new File(path);
		FileInputStream fis = null;
		byte[] b= new byte[100];
		try {
			fis = new FileInputStream(file);
			fis.read(b);
		} catch (FileNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		
	}
}
